# interactive environment that should be shared by bash and zsh

# ensure access to private dotfiles
if command -v prodcertstatus && ! prodcertstatus; then
    prodaccess
fi

# set PATH so it includes user's private bin if it exists
export PATH=~/bin:~/private-dotfiles/bin:"${PATH}"
export PATH=~/prefices/brew/sbin:~/prefices/brew/bin:"${PATH}"
export HOMEBREW_CASK_OPTS="--caskroom=~/Caskroom --binarydir=~/prefices/brew/bin"
export PATH=~/.local/bin:"${PATH}"

#MY PREFERENCES ==============================================================
export EDITOR=vim
export VISUAL=$EDITOR
export GIT_EDITOR=$EDITOR
export P4DIFFOPTS="-u --color"
export P4DIFF="~/bin/p4-difftool"
export PYTHONSTARTUP=~/.pythonrc.py

if [ -z "$LANG" ]; then
  export LANG='en_US.UTF-8'
fi

# Set the default Less options.
export LESS='-XFR -i -M -w -z-4'
export PAGER=less
# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

# Browser
if echo "$OSTYPE" | grep -q '^darwin'; then
  export BROWSER='open'
fi

# don't put duplicate lines in the history. See bash(1) for more options
HISTCONTROL=erasedups

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=1000
HISTFILESIZE=10000

#unmap CTRL-S and CTRL-Q
stty -ixon -ixoff

# fix up TERM values
# get the command name of the session-leader's parent
terminal="$(ps -o comm:1= "$(ps -o ppid:1= "$(ps -o sid:1= $$)")" 2>&-)"
if [[ "$?" -ne 0 ]]; then
  # if our session-leader doesn't have a real real parent (pid:0) then we're running as init
  terminal=init
fi
case "$terminal" in
lxterminal|gnome-terminal|xfce4-terminal)
    export TERM=xterm-256color
    ;;
tmux|"tmux: server")
    export TERM=screen-256color
    ;;
*)
    if ! [[ "$TERM" =~ '^(xterm|screen)-256color$' ]]; then
      echo "Warning, unknown terminal: \"$terminal\" (TERM=$TERM)" >&2
    fi
    ;;
esac

# Further environment
export GEM_HOME=~/prefices/rubygems
export TREES=$HOME/trees

# My very own python!
if [ -f ~/venv/mypy/bin/activate ]; then
  activate() { . ~/venv/mypy/bin/activate; }
  if [ -n "$TMUX" ]; then
    PROMPT_COMMAND='eval `~/bin/tmux-env`'
    activate
  fi
fi

# Temporary Files
if [ ! -d "$TMPDIR" ]; then
  export TMPDIR="/tmp/$USER"
  mkdir -p -m 700 "$TMPDIR"
fi

# added by travis gem
if [ -f ~/.travis/travis.sh ]; then
  . ~/.travis/travis.sh
fi

# vim:ft=zsh:et:sw=2:sts=2:
