# interactive environment that should be shared by bash and zsh
# commands that must be run just once for each new terminal
# generally, this is environment variables
# if your command needs to be run for each new *shell* use ~/.sh_rc

# ensure access to private dotfiles
if command -v prodcertstatus && ! prodcertstatus --check_remaining_hours 8; then
  prodaccess
fi

# save/restore our $PATH, so that we can (re-)source this file idempotently
# currently this is the only environment variable we modify (rather than overwrite), but we should do this for all such
if [[ -z "$__orig_PATH" ]]; then
  export __orig_PATH="$PATH"
else
  PATH="$__orig_PATH"
fi

# set PATH so it includes user's private bin if it exists
export PATH=~/.local/bin:~/prefix/brew/sbin:~/prefix/brew/bin:~/private-dotfiles/bin:~/bin:"$PATH"
export HOMEBREW_CASK_OPTS="--caskroom=~/Caskroom --binarydir=~/prefix/brew/bin"
export HOMEBREW_MAKE_JOBS="$(($(nproc) * 3))"
export HOMEBREW_VERBOSE=1
export HOMEBREW_BUILD_FROM_SOURCE=1
export PATH=~/.local/bin:"${PATH}"

#MY PREFERENCES ==============================================================
export EDITOR=vim
export VISUAL=$EDITOR
export GIT_EDITOR=$EDITOR
export P4DIFFOPTS="-u --color"
export P4DIFF="~/bin/p4-difftool"
export PYTHONSTARTUP=~/.pythonrc.py

if [ -z "$LANG" ]; then
  export LANG='en_US.UTF-8'
fi

# Set the default Less options.
export LESS='-XFR -i -M -w -z-4'
export PAGER=less
# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

# Browser
if echo "$OSTYPE" | grep -q '^darwin'; then
  export BROWSER='open'
fi

#unmap CTRL-S and CTRL-Q
stty -ixon -ixoff

# fix up TERM values
# get the command name of the session-leader's parent
terminal="$(ps -o comm:1= "$(ps -o ppid:1= "$(ps -o sid:1= $$)")" 2>&-)"
if [[ "$?" -ne 0 ]]; then
  # if our session-leader doesn't have a real real parent (pid:0) then we're running as init
  terminal=init
fi
case "$terminal" in
lxterminal|gnome-terminal|xfce4-terminal)
  export TERM=xterm-256color
  ;;
tmux|"tmux: server")
  export TERM=screen-256color
  ;;
*)
  if ! [[ "$TERM" =~ '^(xterm|screen)-256color$' ]]; then
    echo "Warning, unknown terminal: \"$terminal\" (TERM=$TERM)" >&2
  fi
  ;;
esac

# Further environment
export GEM_HOME=~/prefix/rubygems
export TREES=$HOME/trees

# My very own python!
activate() { . ~/venv/mypy/bin/activate; }
if [ -f ~/venv/mypy/bin/activate ]; then
  activate
fi

# Temporary Files
if [ ! -d "$TMPDIR" ]; then
  export TMPDIR="/tmp/$USER"
  mkdir -p -m 700 "$TMPDIR"
fi

# added by travis gem
if [ -f ~/.travis/travis.sh ]; then
  . ~/.travis/travis.sh
fi
if command -v aactivator >/dev/null; then
  eval "$(aactivator init)"
fi

# vim:ft=sh:et:sw=2:sts=2:
