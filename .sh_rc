#!/not/executable/bash
# commands that must be run on each new shell
# generally, this is aliases, shell settings, functions
# if your command only needs to be run once per *terminal* use ~/.sh_env


alias time="/usr/bin/time -ao /dev/tty"

if [ "${BASH:-}" ]; then
  # enable precmd_functions, for zsh compatibility
  source ~/.sh_lib/bash-precmd.sh
fi

mkdir -p $XDG_RUNTIME_DIR/tmux-env

tmux_env() {
  if [ "$TMUX" ]; then
    local var=$XDG_RUNTIME_DIR/tmux-env
    local old=$var/old.$$
    local new=$var/new
    tmux show-env -s > $new
    if test -e $old && cmp -s $old $new; then
      :
    else
      mv $new $old
      source $old
    fi
  fi
}

# set a fancy prompt (non-color, unless we know we "want" color)
 GREEN='\[[1;32m\]'
YELLOW='\[[1;33m\]'
  BLUE='\[[1;34m\]'
PURPLE='\[[1;35m\]'
  TEAL='\[[1;36m\]'
   END='\[[0;39m\]'
   PS1="$TEAL"'$VCS_PS1$VCS_PS2'"$END$BLUE\u$END@$GREEN\h$END:$YELLOW\w$END 
$PURPLE"'[\D{%F %r %z (%a)}]'"$END"'$ '

if [ "${BASH:-}" ]; then
  : good to go.
elif [ "$ZSH_VERSION" ]; then
  # do a bit of transformation on the bash PS1 to make it a zsh PS1
  PS1="$(echo "$PS1" | sed '
    s/\\\[/%{/g
    s/\\\]/%}/g
    s/\\u/%n/g
    s/\\h/%m/g
    s/\\w/%~/g
    s/\\D/%D/g
')"
else
  # dash, or busybox, or similar
  PS1="$(echo "$PS1" | sed '
    s/\\\[/%{/g
    s/\\\]/%}/g
    s/\\u/%n/g
    s/\\h/%m/g
    s/\\w/%~/g
    s/\\D/%D/g
')"
fi

case "$TERM" in
*-256col*|*-col*|*-direct)
    # All's well.
    ;;
*)
    PS1="$(echo "$PS1" | uncolor)"
    ;;
esac

# don't put duplicate lines in the history. See bash(1) for more options
HISTCONTROL=erasedups

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=64000
HISTFILESIZE=512000
SAVEHIST=$HISTFILESIZE
HISTTIMEFORMAT="[%F %r %z] "

alias tmux-env='eval "$(tmux show-env -s)"'
alias crterm='export TERM=xterm-256color; . ~/.bashrc'
reset() {
    ## http://askubuntu.com/a/123296/23034
    tput rmcup
    command reset
}

login() {
  . ~/.profile
  if [ "$ZSH_VERSION" ]; then
    . ~/.zshrc
  fi
}

silent(){
  "$@" >/dev/null 2>&1
}
noisy(){
  echo "+$@" >&2
  "$@"
}

# enable color support of ls and also add handy aliases
if command -v dircolors > /dev/null; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'
fi

# busybox grep doesn't have --color=auto :(
if grep --color=auto -q '' </dev/zero 2>/dev/null; then
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

alias diff='diff -d'
alias info='info --vi-keys'
alias ip='ip --color'

# some more ls aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias ..='noisy cd ..'
alias ...='noisy cd ../..'
alias ....='noisy cd ../../..'
alias .....='noisy cd ../../../..'
alias ......='noisy cd ../../../../..'
alias .......='noisy cd ../../../../../..'

## Add an "alert" alias for long running commands.  Use like so:
##   sleep 10; alert
#alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -re '\''s/^\s*[0-9]+\s*//;s/[;&|]+\s*alert$//'\'')"'

# http://superuser.com/a/599156/50425
title() {
    echo -n "]0;"$*""
}

alert() {
  command alert "$@" "  (status: $?)"
}

# extra shell settings for work
if [ -f ~/private-dotfiles/.sh_rc ]; then
    . ~/private-dotfiles/.sh_rc
fi

if command -v declare >/dev/null; then
  . ~/.sh_advanced_rc
fi
